<md-dialog aria-label="Fiche OSM">
    <form>
        <md-toolbar>
            <div class="md-toolbar-tools">   
                <h2 ng-show = "!editable"   ng-model="geojson.properties.tags.name">  {{geojson.properties.tags.name && geojson.properties.tags.name !='' ? geojson.properties.tags.name : "Sans nom"}}</h2>
                <md-input-container flex ng-show = "editable">
                    <label>Nom</label>
                    <input ng-model="geojson.properties.tags.name">
                </md-input-container>


            </div>
        </md-toolbar>

        <md-dialog-content>
            <!--        <div style="width:100%;heigth:100%">           -->
            <p>Modifié le : {{geojson.properties.meta.timestamp}}  Par : {{geojson.properties.meta.user}}</p>

            <!--MODE LECTURE-->
            <div ng-show = "!editable">
                <md-list>
                    <md-list-item ><!--Clé primaire-->
                        <div class="readA">
                            {{all_tags[primary_tag.k].lbl}}
                        </div>
                        <div class="readB">
                            {{ current_primary_key_config.lbl && current_primary_key_config.lbl || geojson.properties.tags[primary_tag.k] }}
                        </div>
                    </md-list-item>
                    <md-divider></md-divider>
                    <!--Sub tags connu-->
                    <md-list-item ng-repeat="(k ,v ) in geojson.properties.tags"   ng-if="tag_hidden.indexOf(k) == -1 && k != primary_tag.k ">
                        <div class="readA">
<!--                            {{subtags[k] && subtags[k].lbl || k }}-->
                       {{subtags[k].lbl ? subtags[k].lbl : k}}
                        </div>
                        <div class="readB">
<!--                        {{test()}}-->
                        {{findSubTagLabel(k,v)}}
<!--                           {{subtags[k][v].lbl ? subtags[k][v].lbl : v}}-->
<!--                           {{list_sub_tag_of_object.indexOf(v) == -1 ? 'caca':'pipi'}}-->
                          
                        </div>
                        <md-divider ng-if="!$last"></md-divider>
                    </md-list-item>
                </md-list>
            </div>
            <!-- EOF MODE LECTURE-->

            <!--MODE EDITION-->
            <div ng-show = "editable">
                <md-list>
                    <md-list-item ><!--Clé primaire-->
                        <div class="editableA">
                            <md-select ng-model="primary_tag.k" ng-Change='onPrimaryKeyChange(primary_tag.k)' >
                                <md-option ng-repeat="(k,v) in all_tags" value="{{k}}">{{v.lbl}}</md-option>
                            </md-select>
                        </div>
                        <div class="editableB">
                            <md-select ng-show="!customValueType" ng-model = "geojson.properties.tags[primary_tag.k]" >
                                <md-option ng-repeat="f in all_tags[primary_tag.k].values"  value="{{f.key}}">{{f.lbl}}</md-option>
                            </md-select> 
                            <!--custom tag-->
                            <md-input-container ng-show="customValueType">
                                <input ng-show="customValueType" type="text" ng-model="geojson.properties.tags[primary_tag.k]">
                            </md-input-container>
                        </div>
                        <div class="editableC">
                            <!--                            <md-checkbox ng-model="customValueType" class="md-warn"> </md-checkbox>-->
                        </div>
                    </md-list-item>
                    <!--Tag connus-->
                    <md-list-item ng-repeat="n in list_sub_tag_of_object">
                        <div class="editableA">
                            <label>{{subtags[n].lbl}}</label>
                        </div>
                        <div class="editableB">
                            <!--SELECT-->
                            <md-select  ng-if = "subtags[n].type == 'select'" ng-model = "geojson.properties.tags[n]" >
                                <md-option ng-repeat="st in subtags[n].tags"  value="{{st.v}}">{{st.lbl}}</md-option>
                            </md-select> 
                            <!--NUMBER-->
                            <md-input-container ng-if = "subtags[n].type == 'number'">
                                <input type="number" step="any" name="rate" value="{{geojson.properties.tags[n]}}" ng-model = "geojson.properties.tags[n]" >
                            </md-input-container>
                            <!--TEXT-->
                            <md-input-container ng-if = "subtags[n].type == 'text'">
                                <input ng-model="geojson.properties.tags[n]">
                            </md-input-container>
                        </div>
                        <div class="editableC">
                            <!--Bouton pour supprimer un tag-->
                            <i class="fa fa-times fa-2x" style="color:red" ng-click= "supTag(k)"></i>
                        </div>
                    </md-list-item>

                    <!--LE RESTE DES TAGS-->
                    <md-list-item ng-repeat="(k ,v ) in geojson.properties.tags" ng-if="tag_hidden.indexOf(k) == -1 && k != primary_tag.k && list_sub_tag_of_object.indexOf(k) == -1 ">
                        <div class="editableA">
                            <label>{{k}}</label>
                        </div>
                        <div class="editableB">
                            <md-input-container>
                                <input ng-model="geojson.properties.tags[k]">
                            </md-input-container>

                        </div>
                        <div class="editableC">
                            <!--Bouton pour supprimer un tag-->
                            <i class="fa fa-times fa-2x" style="color:red" ng-click= "supTag(k)"></i>
                        </div>
                    </md-list-item>
                    <!--LES CHAMPS POUR AJOUTER UN NOUVEAU TAG-->
                    <md-list-item>
                        <div class="editableA">
                            <md-input-container>
                                <label>Clé</label>
                                <input ng-model="newKV.k_add" ng-lowercase>
                            </md-input-container>
                        </div>
                        <div class="editableB">
                            <md-input-container>
                                <label>Valeur</label>
                                <input ng-model="newKV.v_add">
                            </md-input-container>

                        </div>
                        <div class="editableC">
                            <!--Bouton pour ajouter un tag-->
                            <i class="fa fa-plus-circle fa-2x" ng-click="addTag()" style="color:green;" ></i>
                        </div>
                    </md-list-item>

                    <md-divider ng-if="!$last"></md-divider>
                </md-list>
            </div>



        </md-dialog-content>


        <div class="md-actions" layout="row">
            <span flex></span>

            <md-button ng-show = "!editable" type="button" class="md-primary" style="position:absolute; left:5px; bottom:5px;" ng-click='showEditable()'>
                <i class="fa fa-pencil-square-o" ></i>
            </md-button>
            <md-button ng-show="editable && !sw_delete" class="md-primary" ng-click="ok(geojson)">OK</md-button>
            <md-button class="btn btn-warning" ng-click="cancel()">Annuler</md-button>

            <input type="checkbox" ng-show="editable"  ng-model="sw_delete"></input>

        <md-button ng-show="editable && sw_delete" class="md-primary" ng-click="deleteElement(geojson)">Supprimer!</md-button>


        </div>
    </form>
</md-dialog>